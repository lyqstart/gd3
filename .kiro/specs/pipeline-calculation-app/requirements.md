# 需求文档

## 介绍

油气管道开孔封堵计算APP是一个专业的工程计算工具，旨在为管道施工和维修人员提供精确、高效的尺寸计算功能。该系统将替代传统的纸质计算卡，支持开孔、封堵、下塞堵、解堵等作业场景的自动化计算，降低人工计算误差，提升作业安全性与效率。

## 平台与交付范围

### 目标平台

THE System SHALL 支持以下三个平台：

1. **Web平台**
   - 现代浏览器支持 (Chrome 90+, Safari 14+, Firefox 88+, Edge 90+)
   - 响应式设计，支持桌面和移动浏览器
   - 支持离线访问功能

2. **iOS平台**
   - iOS 12.0+ (iPhone/iPad)
   - 支持企业内部分发

3. **Android平台**
   - Android 8.0+ (API Level 26+)
   - 支持企业内部分发

### 跨平台一致性要求

THE System SHALL 满足以下跨平台一致性需求：

1. **计算一致性要求**
   - THE System SHALL 在所有平台使用相同的计算算法和数学公式
   - THE System SHALL 确保所有平台的计算精度误差在0.1mm范围内
   - THE System SHALL 在所有平台产生完全一致的计算结果

2. **数据一致性要求**
   - THE System SHALL 在所有平台保持相同的数据格式和存储结构
   - THE System SHALL 提供跨平台的数据同步和迁移能力
   - THE System SHALL 支持统一的数据导入导出格式

3. **功能一致性要求**
   - THE System SHALL 在所有平台提供相同的核心功能
   - THE System SHALL 支持各平台独立的用户界面设计和交互优化
   - THE System SHALL 允许平台特定功能的差异化实现

### 交付物

1. **Web应用**
   - 可部署的Web应用程序
   - 支持离线访问功能
   - 浏览器兼容性验证

2. **iOS应用**
   - 可安装的iOS应用程序
   - 企业内部分发版本

3. **Android应用**
   - 可安装的Android应用程序
   - 企业内部分发版本

4. **用户文档**
   - 用户操作手册
   - 系统部署指南

## 术语表

- **System**: 油气管道开孔封堵计算系统
- **Calculator**: 计算引擎模块
- **Parameter_Manager**: 参数管理器
- **Result_Exporter**: 结果导出器
- **User**: 管道施工或维修人员
- **Calculation_Module**: 计算模块（开孔、封堵等）
- **Parameter_Set**: 参数组合
- **Calculation_Record**: 计算记录
- **Diagram_Generator**: 示意图生成器

## 跨平台功能一致性与差异

### 功能一致性要求

THE System SHALL 在所有支持的平台上提供一致的核心功能：

1. **计算功能一致性**
   - 所有计算模块在各平台产生相同结果
   - 相同的计算精度标准（0.1mm误差范围）
   - 一致的参数验证逻辑

2. **数据格式一致性**
   - 统一的数据存储格式
   - 跨平台的参数组和计算记录兼容性
   - 一致的导出文件格式

3. **用户体验一致性**
   - 相同的操作流程和界面布局逻辑
   - 一致的错误提示和帮助信息
   - 统一的主题和视觉风格

### 平台特定差异

#### 移动端特性
- 触摸优化的界面交互
- 设备传感器集成（如适用）
- 移动端特有的分享功能
- 离线优先的数据存储策略

#### Web端特性
- 键盘快捷键支持
- 更大屏幕的布局优化
- 浏览器特有的文件下载机制
- Web端特有的打印功能
- 更丰富的数据展示选项

#### 数据同步差异
- 移动端：优先本地存储，后台同步
- Web端：实时同步，云端优先
- 冲突解决：统一的冲突处理机制







## 平台适用范围说明

### 离线能力适用范围

- WHERE Platform ∈ {iOS, Android}:
  - THE System SHALL 在无网络连接时提供所有核心计算功能
  - THE System SHALL 在本地存储所有计算记录和参数组
  - THE System SHALL 在网络恢复时自动或手动同步本地数据到云端

- WHERE Platform == Web:
  - THE System SHALL 采用在线优先模式
  - THE System SHALL 不要求支持离线存储
  - WHEN 网络不可用时，THE System SHALL 明确提示当前功能不可用

## 需求

### 需求 1: 开孔尺寸计算

**用户故事:** 作为管道施工人员，我希望能够计算开孔作业的各项尺寸参数，以便准确执行开孔操作并确保作业安全。

#### 验收标准

1. 当用户输入管外径、管内径、筒刀外径、筒刀内径、A值、B值、R值、初始值和垫片厚度时，THE Calculator SHALL 计算空行程 S空=A+B+初始值+垫片厚度
2. 当提供管道和筒刀参数时，THE Calculator SHALL 计算筒刀切削距离 C1=√(管外径²-管内径²)-筒刀外径
3. 当提供管道和筒刀参数时，THE Calculator SHALL 计算掉板弦高 C2=√(管外径²-管内径²)-筒刀内径
4. 当计算切削尺寸时，THE Calculator SHALL 使用公式 C=R+C1
5. 当计算开孔总行程时，THE Calculator SHALL 使用公式 S总=S空+C
6. 当计算掉板总行程时，THE Calculator SHALL 使用公式 S掉板=S总+R+C2
7. 当任何输入参数为负数或零时，THE System SHALL 显示错误提示并阻止计算

### 需求 2: 手动开孔尺寸计算

**用户故事:** 作为使用手动开孔机的操作人员，我希望能够计算手动开孔作业的尺寸参数，以便正确设置设备参数。

#### 验收标准

1. 当用户输入L值、J值、P值、T值和W值时，THE Calculator SHALL 计算螺纹咬合尺寸=T-W
2. 当提供相关参数时，THE Calculator SHALL 计算空行程=L+J+T+W
3. 当提供相关参数时，THE Calculator SHALL 计算总行程=L+J+T+W+P
4. 当T值小于W值时，THE System SHALL 显示警告提示螺纹咬合尺寸为负

### 需求 3: 封堵尺寸计算

**用户故事:** 作为管道维修人员，我希望能够计算封堵和解堵作业的尺寸参数，以便准确执行封堵操作。

#### 验收标准

1. 当用户输入R值、B值、E值、垫子厚度和初始值时，THE Calculator SHALL 计算导向轮接触管线行程=R+B+E+垫子厚度+初始值
2. 当用户输入D值、B值、E值、垫子厚度和初始值时，THE Calculator SHALL 计算封堵总行程=D+B+E+垫子厚度+初始值
3. 当执行解堵计算时，THE Calculator SHALL 使用与封堵相同的计算逻辑
4. 当E值（管外径-壁厚）计算结果为负数时，THE System SHALL 显示错误提示

### 需求 4: 下塞堵尺寸计算

**用户故事:** 作为使用手动开孔机进行下塞堵作业的人员，我希望能够计算下塞堵的尺寸参数，以便正确执行塞堵操作。

#### 验收标准

1. 当用户输入T值和W值时，THE Calculator SHALL 计算螺纹咬合尺寸=T-W
2. 当用户输入M值、K值、T值和W值时，THE Calculator SHALL 计算空行程=M+K-T+W
3. 当用户输入M值、K值、N值、T值和W值时，THE Calculator SHALL 计算总行程=M+K+N-T+W
4. 当计算结果出现负值时，THE System SHALL 提供参数检查建议

### 需求 5: 下塞柄尺寸计算

**用户故事:** 作为进行封堵孔/囊孔下塞柄作业的人员，我希望能够计算下塞柄的尺寸参数，以便准确执行塞柄安装。

#### 验收标准

1. 当用户输入F值、G值、H值、垫子厚度和初始值时，THE Calculator SHALL 计算总行程=F+G+H+垫子厚度+初始值
2. 当任何输入参数超出合理范围时，THE System SHALL 显示警告信息
3. THE System SHALL 保持计算精度至小数点后2位

### 需求 6: 参数管理

**用户故事:** 作为经常使用该应用的用户，我希望能够保存和管理常用的参数组合，以便快速重复使用提高工作效率。

#### 验收标准

1. THE Parameter_Manager SHALL 提供常用管外径、管内径、筒刀规格等标准参数的预设选项
2. 当用户创建自定义参数组时，THE Parameter_Manager SHALL 保存参数组合并允许用户命名
3. 当用户选择已保存的参数组时，THE System SHALL 自动填充相应的输入字段
4. THE Parameter_Manager SHALL 支持参数单位在毫米(mm)和英寸(inch)之间切换
5. 当进行单位转换时，THE System SHALL 保持数值精度并正确转换所有相关参数

### 需求 7: 结果可视化与导出

**用户故事:** 作为需要记录和分享计算结果的用户，我希望能够可视化查看结果并导出报告，以便用于作业记录和上报。

#### 验收标准

1. 当计算完成时，THE System SHALL 高亮显示核心行程尺寸结果
2. 当用户查看计算结果时，THE Diagram_Generator SHALL 生成包含关键尺寸标注的作业示意图
3. 当用户请求导出时，THE Result_Exporter SHALL 生成包含参数明细、计算公式和结果数值的PDF报告
4. 当用户请求导出时，THE Result_Exporter SHALL 支持Excel格式导出
5. THE System SHALL 在示意图中标注联箱口、夹板阀顶、筒刀等关键位置
6. 当生成报告时，THE System SHALL 包含完整的计算过程和公式展示

### 需求 8: 作业指引与帮助

**用户故事:** 作为新手用户或需要参考的操作人员，我希望能够获得详细的操作指引和帮助信息，以便正确使用应用和理解参数含义。

#### 验收标准

1. 当用户访问任何计算模块时，THE System SHALL 提供该模块的图文操作教程
2. 当用户点击参数输入框的帮助图标时，THE System SHALL 显示该参数的定义和测量方法
3. THE System SHALL 提供常见问题解答功能，包含参数混淆和计算误差排查方案
4. 当出现计算异常时，THE System SHALL 提供具体的问题诊断建议
5. THE System SHALL 为每个参数提供清晰的中文说明和示例

### 需求 9: 数据存储与同步

**用户故事:** 作为需要在多个设备上使用应用的用户，我希望能够安全地存储计算记录并通过企业自建服务器在设备间同步，以便随时访问历史数据并确保数据安全可控。

#### 验收标准

1. THE System SHALL 自动将计算记录保存到本地存储
2. 当网络不可用时，THE System SHALL 继续正常提供所有计算功能（离线优先）
3. WHERE 用户选择云端同步功能，THE System SHALL 通过企业自建服务器提供账号登录和数据云端存储
4. WHERE 用户启用云端同步，THE System SHALL 通过企业自建服务器在多设备间同步参数组和计算记录
5. THE System SHALL 确保本地数据的安全性和完整性
6. 当发生数据冲突时，THE System SHALL 提供冲突解决选项（保留本地 / 保留云端 / 合并数据）
7. THE System SHALL 提供用户身份验证和授权机制
8. THE System SHALL 支持离线数据队列，在网络恢复时自动同步
9. THE System SHALL 不依赖第三方公有云服务（如Firebase、AWS等），所有数据存储在企业自建服务器


### 需求 10: 计算精度与验证

**用户故事:** 作为对计算精度要求严格的工程人员，我希望系统能够提供高精度计算并验证结果的准确性，以确保作业安全。

#### 验收标准

1. THE Calculator SHALL 保持所有计算结果的精度误差小于等于0.1mm
2. 当执行平方根运算时，THE Calculator SHALL 使用双精度浮点数确保计算精度
3. 当处理分数运算时，THE Calculator SHALL 正确处理运算优先级和括号
4. THE System SHALL 提供计算结果与手动计算对比的验证功能
5. 当计算结果超出安全范围时，THE System SHALL 显示安全预警
6. THE Calculator SHALL 正确处理所有数学公式中的运算符优先级

### 需求 11: 用户界面与交互

**用户故事:** 作为在现场环境中使用应用的操作人员，我希望界面简洁易用且适合工业环境，以便在各种光线条件下都能清晰操作。

#### 验收标准

1. THE System SHALL 采用深色模式界面以减少强光下的视觉疲劳
2. THE System SHALL 使用高对比度配色方案，关键按钮和结果使用红色/橙色突出显示
3. THE System SHALL 支持现代移动设备和Web浏览器
4. 当用户输入参数时，THE System SHALL 提供清晰的输入验证和错误提示
5. THE System SHALL 在不同屏幕尺寸的设备上保持良好的界面适配
6. 当用户操作时，THE System SHALL 提供即时的视觉反馈和状态提示

### 需求 12: 离线功能支持

**用户故事:** 作为经常在网络信号不佳的现场工作的用户，我希望应用能够完全离线工作，以确保在任何环境下都能正常使用。

#### 验收标准

1. THE System SHALL 在无网络连接时提供所有核心计算功能
2. THE System SHALL 在本地存储所有必要的计算逻辑和参数数据
3. 当网络恢复时，THE System SHALL 自动同步本地生成的计算记录
4. THE System SHALL 在离线状态下正常保存和加载用户的参数组
5. 当离线时，THE System SHALL 明确标识哪些功能需要网络连接

### 需求 13: 系统架构与一致性

**用户故事:** 作为系统用户，我希望在不同平台上使用相同的计算功能并获得一致的结果，以确保工作的连续性和数据的可靠性。

#### 验收标准

1. **计算一致性要求**
   - THE System SHALL 在所有平台使用相同的计算算法和数学公式
   - THE System SHALL 确保所有平台的计算精度误差在0.1mm范围内
   - THE System SHALL 在Web、iOS、Android平台产生完全一致的计算结果
   - THE System SHALL 提供计算结果一致性验证机制

2. **数据兼容性要求**
   - THE System SHALL 支持跨平台的数据同步和迁移
   - THE System SHALL 提供统一的数据模型定义，确保跨平台数据兼容性
   - THE System SHALL 支持统一的数据导入导出格式
   - THE System SHALL 提供数据格式兼容性验证机制

3. **功能一致性要求**
   - THE System SHALL 在所有平台提供相同的核心计算功能
   - THE System SHALL 支持统一的错误处理和日志记录标准
   - THE System SHALL 允许各平台进行用户界面设计和交互优化
   - THE System SHALL 支持平台特定功能的扩展

4. **系统可扩展性要求**
   - THE System SHALL 支持新计算模块的添加而不影响现有功能
   - THE System SHALL 支持系统功能的独立测试和验证
   - THE System SHALL 提供清晰的功能模块边界和接口定义
   - THE System SHALL 支持系统组件的独立更新和维护

## 非功能性要求（汇总）

### 性能要求

1. **响应时间**
   - 计算操作响应时间 ≤ 200ms
   - 界面切换响应时间 ≤ 100ms
   - 数据加载时间 ≤ 2秒

2. **并发处理**
   - 支持单用户多计算任务并行处理
   - Web端支持多标签页同时使用

3. **资源占用**
   - 移动端内存占用 ≤ 100MB
   - 移动端存储空间 ≤ 50MB
   - Web端浏览器内存占用 ≤ 200MB

### 可靠性要求

1. **系统稳定性**
   - 系统可用性 ≥ 99.5%
   - 计算结果准确性 100%（在规定精度范围内）
   - 数据完整性保证 100%

2. **错误处理**
   - 优雅的错误恢复机制
   - 完整的错误日志记录
   - 用户友好的错误提示

3. **数据安全**
   - 本地数据加密存储
   - 网络传输数据加密
   - 用户隐私数据保护

### 兼容性要求

1. **平台兼容性**
   - iOS 12.0+ 完全兼容
   - Android 8.0+ 完全兼容
   - 主流浏览器完全兼容

2. **设备兼容性**
   - 支持不同屏幕尺寸和分辨率
   - 支持横屏和竖屏模式
   - 适配不同设备性能等级

3. **数据兼容性**
   - 向后兼容历史数据格式
   - 跨平台数据格式统一
   - 导出格式标准化

### 可用性要求

1. **用户界面**
   - 符合平台设计规范
   - 支持无障碍访问
   - 多语言支持（当前为中文）

2. **学习成本**
   - 新用户上手时间 ≤ 10分钟
   - 完整功能掌握时间 ≤ 30分钟
   - 提供完整的帮助文档

3. **操作效率**
   - 常用操作步骤 ≤ 3步
   - 支持快捷操作和批量处理
   - 智能参数推荐和自动填充

### 可维护性要求

1. **代码质量**
   - 模块化架构设计
   - 完整的单元测试覆盖
   - 规范的代码文档

2. **系统监控**
   - 性能监控和报警
   - 错误追踪和分析
   - 用户行为分析（可选）

3. **更新机制**
   - 支持热更新（Web端）
   - 渐进式更新策略
   - 版本回滚能力

### 安全性要求

1. **数据安全**
   - 敏感数据加密存储
   - 安全的数据传输协议
   - 定期数据备份机制

2. **访问控制**
   - 用户身份验证
   - 数据访问权限控制
   - 审计日志记录

3. **系统安全**
   - 防止恶意攻击
   - 输入数据验证和过滤
   - 安全漏洞定期检查

### 扩展性要求

1. **功能扩展**
   - 支持新计算模块添加
   - 支持新参数类型扩展
   - 支持新导出格式添加

2. **平台扩展**
   - 预留其他平台接入能力
   - 支持第三方系统集成
   - API接口标准化设计

3. **数据扩展**
   - 支持大量历史数据存储
   - 支持数据分析和统计
   - 支持数据导入导出扩展